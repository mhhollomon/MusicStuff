
<!--- CONTROLS -->

<!-- Mode Selection -->
<div class="ma2">
    <div class="flex">
        <mat-form-field>
            <mat-label>Mode</mat-label>
            <mat-select [(ngModel)]="mode" (selectionChange)="mode_change()" >
                <mat-option value="Diatonic">Diatonic</mat-option>
                <mat-option value="Chromatic">Chromatic</mat-option>
            </mat-select>
        </mat-form-field>
    </div>
</div>    

<!-- General Parameters -->
<div class="ma2">
    <div class="param-container">

        <!-- Chord Count -->
            <mat-form-field>
                <mat-label>Chord Count</mat-label>
                <input name="chord_count" matNativeControl type="number" 
                    [max]="chord_count_max" min="1" required [(ngModel)]="chord_count" #count_control="ngModel">
                <mat-error *ngIf="count_control.invalid">count &lt;{{chord_count_max}} and &gt;1</mat-error>
            </mat-form-field>
        <!-- Duplicates -->
            <mat-form-field>
                <mat-label>Duplicates</mat-label>
                <mat-select [(ngModel)]="duplicates" >
                    <mat-option value="none">None</mat-option>
                    <mat-option value="not-adjacent">Not Adjacent</mat-option>
                    <mat-option value="any">Any</mat-option>
                </mat-select>
            </mat-form-field>
    </div>
</div>

<!-- Chord Type Selection -->
<div class="ma2 chord-type-container" >
    <mat-label class="mr2 mt2 mhh-mat-label">Chord Types</mat-label>
    <div class="chord-type-checkbox-container">
        <div>
            <mat-checkbox [(ngModel)]="allow_triads" matTooltip="Allow Triads to be generated">Triads</mat-checkbox>
            <br>
            <mat-slider min="1" max="5" step="0.5"  [disabled]="!allow_triads" matTooltip="Set the relative weighting for triads">
                <input matSliderThumb [(ngModel)]="triad_weight">
            </mat-slider>
        </div>

        <div>
            <mat-checkbox [(ngModel)]="allow_sevenths" matTooltip="Allow 7th chords to be generated">7ths</mat-checkbox>
            <br>
            <mat-slider min="1" max="5" step="0.5"  [disabled]="!allow_sevenths" matTooltip="Set the relative weighting for 7ths">
                <input matSliderThumb [(ngModel)]="sevenths_weight">
            </mat-slider>
        </div>
        
        <div>
            <mat-checkbox [(ngModel)]="allow_ninths" matTooltip="Allow 9th chords to be generated">9ths</mat-checkbox>
            <br>
            <mat-slider min="1" max="5" step="0.5"  [disabled]="!allow_ninths" matTooltip="Set the relative weighting for 9ths">
                <input matSliderThumb [(ngModel)]="ninths_weight">
            </mat-slider>
        </div>
    </div>
</div> 

<!-- Key Selection  (Diatonic only) -->
<div class="ma2" *ngIf="!scale_disabled">
    <label class="mhh-mat-label">Key</label>
    <mat-radio-group [(ngModel)]="scale_source">
        <mat-radio-button value="Random" matTooltip="Let the computer choose the key">Random</mat-radio-button>
        <mat-radio-button value="Selected" matTooltip="You pick the key">Selected</mat-radio-button>
    </mat-radio-group>

    
    <div class="mt2 mh4 param-container" *ngIf="scale_source === 'Selected'">

        <!-- Sonority -->
        <mat-form-field>
            <mat-label>Tonality</mat-label>
            <mat-select [(ngModel)]="selected_sonority">
                <mat-option value="major">Major</mat-option>
                <mat-option value="minor">Minor</mat-option>
                <mat-option value="mixolydian">Mixolydian</mat-option>
                <mat-option value="dorian">Dorian</mat-option>
                <mat-option value="lydian">Lydian</mat-option>
                <mat-option value="phrygian">Phrygian</mat-option>
            </mat-select>
        </mat-form-field>

        <!-- Key Center -->
        <mat-form-field>
            <mat-label>Key Center</mat-label>
            <mat-select  [(ngModel)]="selected_key">
                <mat-option value="Random">Random</mat-option>
                <mat-option value={{k}} 
                    *ngFor="let k of (selected_sonority==='minor' ? minorkeys : majorkeys)">
                        {{k}}
                </mat-option>
            </mat-select>
        </mat-form-field>
    </div>
</div> 

<!-- Generate Button -->
<div class="db mv4 br2 ma2">
    <button  mat-raised-button id="generate_chords_button" color="primary" (click)="generate()">Generate Chords</button>
</div>

<!-- OUTPUT -->
<div class="ba bw1 br3 ph2 min-h-2">
    <div class="mt2"></div>
    <!-- Key Information -->
    <mat-expansion-panel [disabled]="mode === 'Chromatic'">
        <mat-expansion-panel-header>
          <mat-panel-title>
            <div class="chord-panel-title-container mt1">
                <label class="chord-panel-title-key mr2">{{getPanelTitle()}}</label>
                <div class="chord-panel-title-buttons">
                    <button mat-icon-button class="material-symbols-outlined"
                                matTooltip="Show/Hide the actual chord tones"  
                                (click)="chord_tone_change($event)">
                        <mat-icon>{{ show_chord_tones ? 'visibility_off' : 'visibility' }} </mat-icon>
                    </button>
                    <button class="ml4 ba br2" mat-icon-button class="material-symbols-outlined" 
                            matTooltip="Download midi file for the chords" (click)="generate_midi($event)" >
                        <mat-icon>download</mat-icon>
                    </button>
                </div>
            </div>
          </mat-panel-title>
        </mat-expansion-panel-header>
        <span class="mh2" *ngFor="let n of scale_notes">{{n.noteDisplay()}}</span>
    </mat-expansion-panel>

    <!-- Chord Information -->
    <div class="chord-container ml3 pb3">
        <ng-template ngFor let-c [ngForOf]="chords">
            <div class="chord-name mv2">
                <button class="dif" matTooltip="Play the chord through your speakers or headphones" (click)="play_chord(c)" mat-mini-fab>>></button>
                <span class="dif">{{c.computeNameDisplay()}}</span>
            </div>
            <div class="chord-tones mv2 mr1" *ngIf="show_chord_tones">
                <span class="dib mh2" *ngFor="let t of c.invertedChordTones()" >{{t.noteDisplay()}}</span>
            </div>
            <span class="chord-info mh2" *ngIf="show_chord_tones" >{{c.chordType}} {{c.inversionAbbrev()}}</span>
        </ng-template>
    </div>
</div>

<!-- FOOTNOTES -->
<ul class="mv4 i f6 indent-small">
    <li>Two chords are consider duplicate if the root notes are the same - inversion and quality are not consulted.</li>
    <li>3rd Inversion 7ths are never generated.</li>
    <li>For 9ths, the 9th is never "inverted", any inversion is calculated as if the chord was a triad or 7th.</li>
    <li>In <span class="b">Chromatic</span> mode
        <ul class="indent-small">
            <li>Dominant 7ths are never generated</li>    
            <li>The chord qualities are weighted in the ratio they appear in a major scale.</li>  
        </ul>
    </li>  
</ul>
